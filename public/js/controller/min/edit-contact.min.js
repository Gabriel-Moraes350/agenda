var userId;$(window).on("load",function(){callUserApi(void 0),$("#image-preview").click(function(){returnFile().trigger("click")}),returnFile().change(function(){let e=$("#image-preview"),a=$(this),r=this.files[0],n=new FileReader;n.onload=function(r){e.attr("src",r.target.result),$("#close-btn").attr("hidden",!1),$("#close-btn").click(function(r){r.preventDefault(),$(a).val(""),e.attr("src",DEFAULT_USER_IMAGE),$(this).attr("hidden",!0)})},n.readAsDataURL(r)}),$(document).on("click","#close-btn",function(e){e.preventDefault(),!0===imageFromApi&&$.ajax({url:"/user/remove-image/",type:"POST",dataType:"JSON",data:{id:userId}}).done(function(e){!0!==e.error?(swal("Sucesso",e.message,"success"),resetImage()):swal("Erro",e.message,"error")}).fail(function(e){swal("Erro",e.message,"error")}).always(function(){})}),$("#form-contact").on("submit",function(e){e.preventDefault(),e.stopPropagation();let a={id:userId,name:returnValueFields().name,email:returnValueFields().email,info:returnValueFields().info,address:returnValueFields().address,user_phones:[returnValueFields().phone1,returnValueFields().phone2,returnValueFields().phone3]},r=new User(a);if(!formValidation(r))return;let n=r.getValues();$(".main").block({message:$("#preloader").html()}),$.ajax({url:"/user/edit",type:"POST",dataType:"JSON",data:n}).done(function(e){if(!0===e.error)return void swal("Erro",e.message,"error");let a=e.data.id,r=returnFile();if(""!=r.val()){var n=new FormData;n.append("picture",r[0].files[0]),$.ajax({url:"/user/image?id="+a,type:"POST",dataType:"json",processData:!1,contentType:!1,data:n}).done(function(e){!0!==e.error?(swal("Sucesso",e.message,"success"),r.val(""),imageFromApi=!0):swal("Erro ao salvar imagem","Contato salvo, porém imagem não pode ser salva","warning")}).fail(function(){swal("Erro ao salvar imagem","Contato salvo, porém imagem não pode ser salva","warning")}).always(function(){})}else swal("Sucesso",e.message,"success")}).fail(function(e){swal("Erro",e.message,"error")}).always(function(){$(".main").unblock(),resetValidClasses()})})});var imageFromApi=!1;function callUserApi(e){$.blockUI({message:$("#preloader").html()}),$.ajax({url:"/user/get?id="+getValueUrl(USER_PARAM),type:"POST",dataType:"JSON"}).done(function(a){e=new User(a.data),userId=e.id,insertFields(e)}).fail(function(){window.location.href="/"}).always(function(){$.unblockUI()})}function insertFields(e){returnFields().name.val(e.name),returnFields().email.val(e.email),returnFields().address.val(e.address),returnFields().info.val(e.info),$.each(e.phone,function(e,a){0==e?returnFields().phone1.val(a.phone):1==e?returnFields().phone2.val(a.phone):2==e&&returnFields().phone3.val(a.phone)}),null!=e.image&&""!=e.image&&($("#image-preview").attr("src",IMAGE_FOLDER+e.image),$("#close-btn").attr("hidden",!1),imageFromApi=!0),maskPhones()}function resetImage(){$("#image-preview").attr("src",DEFAULT_USER_IMAGE),$("#close-btn").attr("hidden",!0),imageFromApi=!1}