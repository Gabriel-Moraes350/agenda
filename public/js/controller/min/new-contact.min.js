$(window).on("load",function(){maskPhones(),$("#image-preview").click(function(){returnFile().trigger("click")}),returnFile().change(function(){let e=$("#image-preview"),a=$(this),r=this.files[0],n=new FileReader;n.onload=function(r){e.attr("src",r.target.result),$("#close-btn").attr("hidden",!1),$("#close-btn").click(function(r){r.preventDefault(),$(a).val(""),e.attr("src",DEFAULT_USER_IMAGE),$(this).attr("hidden",!0)})},n.readAsDataURL(r)}),$("#form-contact").on("submit",function(e){e.preventDefault(),e.stopPropagation();let a={id:null,name:returnValueFields().name,email:returnValueFields().email,info:returnValueFields().info,address:returnValueFields().address,user_phones:[returnValueFields().phone1,returnValueFields().phone2,returnValueFields().phone3]},r=new User(a);if(!formValidation(r))return;let n=r.getValues();$(".main").block({message:$("#preloader").html()}),$.ajax({url:"/user/new",type:"POST",dataType:"JSON",data:n}).done(function(e){if(!0===e.error)return void swal("Erro",e.message,"error");let a=e.data.id,r=returnFile();if(""==r.val())return swal("Novo contato inserido",e.message,"success"),void resetForm();var n=new FormData;n.append("picture",r[0].files[0]),$.ajax({url:"/user/image?id="+a,type:"POST",dataType:"json",processData:!1,contentType:!1,data:n}).done(function(e){!0!==e.error?swal("Novo contato inserido",e.message,"success"):swal("Erro ao salvar imagem","Contato salvo, porém imagem não pode ser salva","warning")}).fail(function(){swal("Erro ao salvar imagem","Contato salvo, porém imagem não pode ser salva","warning")}).always(function(){resetForm()})}).fail(function(e){swal("Erro",e.message,"error")}).always(function(){$(".main").unblock()})})});